# wave-elliptic
Uses Dr. Pretorius' PAMR and AMRD code to solve the wave equation in cylindrical coordinates. This is used as a source for Poisson's equation in Cartesian coordinates. When adaptive mesh refinement is used  or the problem is split up over several processors, the MG variables become non-smooth at the refinement boundaries. It should be noted that the wave equation is not coupled to the potential field; it only sources it.


****

The equations to be solved are:

diff(f,t)   = f_t,
diff(f_t,t) = 1/r diff(r*diff(f,r),r) + diff(f,z$2),

with Neumann BCs on the r=0 boundary and Dirichlet BCs elsewhere. Additionally it solves the elliptic problem:

diff(psi_t0,r$2) + diff(psi_t0,r$2) - f*f = 0

with Dirichlet BCs everywhere.

The psi variable currently does nothing. The original idea was to use psi_t0 to solve an elliptic equation at t=0 and then evolve that initial data with a hyperbolic equation via the psi variable. Until I get everything else working to my satisfaction, this is on hold.

****

The FORTRAN code for these updates was generated by Maple, and isn't super readable, so I will do my best to describe it here. The evolution equations are solved using iterative Crank Nicolson, while the elliptic equations are  solved on each time level with underrelaxed Newton steps (psi_t0_np1 = psi_t0_n + 0.9*res/Jac). 

If you run the code, everything looks great to the naked eye. If, however, you take the second derivative of psi_t0 with respect to x or y in DV, you begin to see some odd behavior. At the boundaries of the AMR regions there are small spikes. More disturbingly, at these same spikes exist at the boundaries of the processor domains when run on more than one processor. I know that one wouldn't expect second derivatives to match perfectly at the domain boundaries given that you have to use different finite difference approximations here, but you would expect the differences to be consistent with truncation error and these are most definitely not.

Any help determining how to fix this problem would be very much appreciated. I would not be supprised if I was just doing somthing stupid when initializing the grid-functions. Thanks for your time.
